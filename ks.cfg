#
text
timezone Europe/Moscow --utc
# Lock root password
rootpw --lock
# Create User Account
user --name=user --password=fedora --groups=wheel #--iscrypted
# lang&keyboard settings
keyboard --xlayouts=us,ru --switch=grp:alt_shift_toggle
lang en_US --addsupport=ru_RU
# Installation source and repos
url --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&arch=$basearch
#url --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=fedora-39&arch=x86_64
repo --name=fedora-updates            --install --cost=0 # --mirrorlist=https://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f$releasever&arch=$basearch --cost=0
repo --name=rpmfusion-free            --install          # --mirrorlist=https://mirrors.rpmfusion.org/mirrorlist?repo=free-fedora-$releasever&arch=$basearch
repo --name=rpmfusion-free-updates    --install --cost=0 # --mirrorlist=https://mirrors.rpmfusion.org/mirrorlist?repo=free-fedora-updates-released-$releasever&arch=$basearch --cost=0
repo --name=rpmfusion-nonfree         --install          # --mirrorlist=https://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-fedora-$releasever&arch=$basearch
repo --name=rpmfusion-nonfree-updates --install --cost=0 # --mirrorlist=https://mirrors.rpmfusion.org/mirrorlist?repo=nonfree-fedora-updates-released-$releasever&arch=$basearch --cost=0
# Clear disk partitions
zerombr
# Configure bootloader and disk partitions
bootloader --driveorder=vda
clearpart --all --drives=vda --initlabel
reqpart --add-boot
part /boot --fstype=ext4 --size=1024 --ondisk=vda
part btrfs.main --fstype=btrfs --encrypted --grow --fsoptions="compress=zstd:1,discard=async,space_cache=v2" --passphrase="fedora" --ondisk=vda
btrfs none --label=fedora-btrfs btrfs.main
btrfs / --subvol --name=root fedora-btrfs
btrfs /home --subvol --name=home fedora-btrfs
btrfs /var/log --subvol --name=var_log fedora-btrfs
btrfs /var/lib/libvirt/images --subvol --name=libvirt_images fedora-btrfs
# Configure Network Interfaces
network --onboot=yes --bootproto=dhcp --hostname=fedora-virt
# Configure Firewall
firewall --enabled
# SELinux configuration
#selinux --permissive
# Configure X Window System
xconfig --startxonboot
# Additional packages
%packages
@^minimal-environment
#@^xfce-desktop-environment
#@^workstation-product-environment
zram-generator
zram-generator-defaults
neovim
git
gh
%end
# Post installation
%post
#Turning off copy-on-write for libvirt images directory
chattr +C /var/lib/libvirt/images
# boot in graphical mode
systemctl set-default graphical.target
%end
# Reboot After Installation
reboot --eject
